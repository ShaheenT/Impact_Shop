describe('User has High Loading Times', () => {
  before(() => {
    // Increase the network throttling to simulate a slow connection
    cy.server()
    cy.route('**/inventory**').as('inventory')
    cy.visit('/', {
      onBeforeLoad(win) {
        cy.stub(win, 'fetch').withArgs('**/inventory**').as('fetch')
      },
    }).then(() => {
      cy.wait('@fetch')
      cy.wait('@inventory')
      cy.viewport(480, 800)
    })
  })

  it('can log in successfully', () => {
    cy.get('[data-test="username"]').type('standard_user')
    cy.get('[data-test="password"]').type('secret_sauce')
    cy.get('[data-test="login-button"]').click()
    cy.url().should('include', '/inventory.html')
  })

  it('can add a product to their cart', () => {
    cy.contains('Sauce Labs Backpack').click()
    cy.get('[data-test="add-to-cart"]').click()
    cy.get('[data-test="shopping-cart-badge"]').contains('1')
  })

  it('can check out and complete a purchase', () => {
    cy.visit('/cart.html')
    cy.get('[data-test="checkout"]').click()
    cy.get('[data-test="first-name"]').type('John')
    cy.get('[data-test="last-name"]').type('Doe')
    cy.get('[data-test="postal-code"]').type('12345')
    cy.get('[data-test="continue"]').click()
    cy.get('[data-test="finish"]').click()
    cy.contains('THANK YOU FOR YOUR ORDER')
  })

  it('can view their order history', () => {
    cy.visit('/inventory.html?view=orders')
    cy.contains('Order History')
  })

  it('can log out successfully', () => {
    cy.get('[data-test="logout"]').click()
    cy.url().should('include', '/index.html')
  })
})
